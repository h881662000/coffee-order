<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>咖啡熟豆訂購平台</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles-extended.css">
    <link rel="stylesheet" href="admin-styles.css">
    <link rel="stylesheet" href="elegant-effects.css">
</head>
<body>
    <header>
        <div class="container">
            <h1 id="site-title">☕ 咖啡熟豆訂購平台</h1>
            <nav class="header-nav">
                <button onclick="showOrderSearchModal()" class="nav-btn">訂單查詢</button>
                <button onclick="showMyOrders()" class="nav-btn">我的訂單</button>
                <div id="member-area" class="member-area"></div>
                <button id="admin-panel-btn" onclick="showAdminPanel()" class="nav-btn" style="display: none;">🛠️ 管理者面板</button>
                <div class="cart-icon" onclick="toggleCart()">
                    🛒 購物車 (<span id="cart-count">0</span>)
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- 推薦商品區 -->
        <section id="home-recommendations" class="recommendations">
            <!-- 推薦商品會由 JavaScript 動態生成 -->
        </section>

        <section class="products">
            <h2>精選咖啡豆</h2>
            <div class="product-grid" id="product-grid">
                <!-- 產品會由 JavaScript 動態生成 -->
            </div>
        </section>
    </main>

    <!-- 購物車側邊欄 -->
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h2>購物車</h2>
            <button class="close-btn" onclick="toggleCart()">✕</button>
        </div>
        <div class="cart-items" id="cart-items">
            <!-- 購物車項目 -->
        </div>

        <!-- 購物車推薦 -->
        <div id="cart-recommendations" style="display:none;"></div>

        <!-- 優惠券區 -->
        <div class="cart-coupon">
            <input type="text" id="coupon-code" placeholder="輸入優惠券代碼">
            <button onclick="applyCoupon()" class="apply-coupon-btn">套用</button>
            <button onclick="showAvailableCoupons()" class="view-coupons-btn">查看優惠券</button>
        </div>

        <div class="cart-footer">
            <div id="order-price-summary" class="price-summary">
                <div class="price-row">
                    <span>總計：</span>
                    <span id="cart-total">NT$ 0</span>
                </div>
            </div>
            <button class="checkout-btn" onclick="showCheckoutForm()">結帳</button>
        </div>
    </div>

    <!-- 結帳表單遮罩 -->
    <div class="modal" id="checkout-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>填寫訂購資訊</h2>
                <button class="close-btn" onclick="closeCheckoutForm()">✕</button>
            </div>
            <form id="checkout-form" onsubmit="submitOrder(event)">
                <div class="form-group">
                    <label for="customer-name">姓名 *</label>
                    <input type="text" id="customer-name" required>
                </div>
                <div class="form-group">
                    <label for="customer-phone">電話 *</label>
                    <input type="tel" id="customer-phone" required>
                </div>
                <div class="form-group">
                    <label for="customer-email">Email</label>
                    <input type="email" id="customer-email">
                </div>
                <div class="form-group">
                    <label for="customer-address">地址 *</label>
                    <textarea id="customer-address" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="customer-note">備註</label>
                    <textarea id="customer-note" rows="2"></textarea>
                </div>

                <!-- 付款方式選擇 -->
                <div class="form-group">
                    <label>付款方式 *</label>
                    <div id="payment-methods"></div>
                </div>

                <!-- 驗證碼 -->
                <div class="form-group captcha-group">
                    <label>安全驗證 *</label>
                    <div class="captcha-container">
                        <div class="captcha-question" id="captcha-question">載入中...</div>
                        <input type="number" id="captcha-answer" placeholder="請輸入答案" required>
                        <button type="button" onclick="refreshCaptcha()" class="captcha-refresh">🔄 重新整理</button>
                    </div>
                    <p class="captcha-hint">請計算上方算式以驗證您不是機器人</p>
                </div>

                <div class="order-summary">
                    <h3>訂單明細</h3>
                    <div id="order-summary-items"></div>
                    <div class="order-total">
                        <strong>總金額：<span id="order-total">NT$ 0</span></strong>
                    </div>
                </div>
                <button type="submit" class="submit-btn">送出訂單</button>
            </form>
        </div>
    </div>

    <!-- 訂單完成訊息 -->
    <div class="modal" id="success-modal">
        <div class="modal-content success-content">
            <div class="success-icon">✓</div>
            <h2>訂單已送出！</h2>
            <p>我們已收到您的訂單，將盡快與您聯繫確認。</p>
            <p class="order-number">訂單編號：<span id="order-number"></span></p>
            <button class="submit-btn" onclick="closeSuccessModal()">返回首頁</button>
        </div>
    </div>

    <!-- 會員登入 -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>登入</h2>
                <button class="close-btn" onclick="closeLoginModal()">✕</button>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="login-account">帳號 / Email / 電話 *</label>
                    <input type="text" id="login-account" placeholder="請輸入帳號、Email 或電話" required>
                </div>
                <div class="form-group">
                    <label for="login-password">密碼</label>
                    <input type="password" id="login-password" placeholder="會員登入可留空，管理者請輸入密碼">
                    <small style="color: #6c757d; font-size: 12px;">會員登入：輸入 Email 或電話，密碼留空<br>管理者登入：輸入帳號和密碼</small>
                </div>
                <button type="submit" class="submit-btn">登入</button>
                <p class="form-footer">還不是會員？<a href="#" onclick="closeLoginModal();showRegisterModal()">立即註冊</a></p>
            </form>
        </div>
    </div>

    <!-- 會員註冊 -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>會員註冊</h2>
                <button class="close-btn" onclick="closeRegisterModal()">✕</button>
            </div>
            <form id="register-form" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label for="register-name">姓名 *</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email *</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label for="register-phone">電話 *</label>
                    <input type="tel" id="register-phone" required>
                </div>
                <div class="form-group">
                    <label for="register-address">地址</label>
                    <textarea id="register-address" rows="3"></textarea>
                </div>
                <button type="submit" class="submit-btn">註冊</button>
            </form>
        </div>
    </div>

    <!-- 會員中心 -->
    <div class="modal" id="profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>會員中心</h2>
                <button class="close-btn" onclick="closeProfileModal()">✕</button>
            </div>
            <div id="profile-content"></div>
        </div>
    </div>

    <!-- 訂單查詢 -->
    <div class="modal" id="order-search-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>訂單查詢</h2>
                <button class="close-btn" onclick="closeOrderSearchModal()">✕</button>
            </div>
            <form onsubmit="searchOrder(event)">
                <div class="form-group">
                    <label>查詢方式</label>
                    <select id="search-type">
                        <option value="orderNumber">訂單編號</option>
                        <option value="phone">電話</option>
                        <option value="email">Email</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>輸入查詢資料</label>
                    <input type="text" id="search-value" required>
                </div>
                <button type="submit" class="submit-btn">查詢</button>
            </form>
            <div id="search-results"></div>
        </div>
    </div>

    <!-- 訂單詳情 -->
    <div class="modal" id="order-detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>訂單詳情</h2>
                <button class="close-btn" onclick="closeOrderDetailModal()">✕</button>
            </div>
            <div id="order-detail-content"></div>
        </div>
    </div>

    <!-- 優惠券列表 -->
    <div class="modal" id="coupons-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>可用優惠券</h2>
                <button class="close-btn" onclick="closeCouponsModal()">✕</button>
            </div>
            <div id="coupons-list"></div>
        </div>
    </div>

    <!-- 庫存管理（管理員） -->
    <div class="modal" id="inventory-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>庫存管理</h2>
                <button class="close-btn" onclick="closeInventoryModal()">✕</button>
            </div>
            <div id="inventory-content"></div>
        </div>
    </div>

    <!-- 新增評價 -->
    <div class="modal" id="add-review-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>撰寫評價</h2>
                <button class="close-btn" onclick="closeAddReviewModal()">✕</button>
            </div>
            <form id="add-review-form" onsubmit="submitReview(event)">
                <input type="hidden" id="review-product-id">
                <div class="form-group">
                    <label>評分</label>
                    <input type="range" id="review-rating" min="1" max="5" value="5"
                           oninput="updateRatingStars(this.value)">
                    <div id="rating-display" class="rating-display">★★★★★</div>
                </div>
                <div class="form-group">
                    <label for="review-comment">評價內容</label>
                    <textarea id="review-comment" rows="5" required></textarea>
                </div>
                <button type="submit" class="submit-btn">送出評價</button>
            </form>
        </div>
    </div>

    <!-- 管理者面板 -->
    <div class="modal" id="admin-panel-modal">
        <div class="modal-content">
            <div class="admin-header-bar">
                <h2>🛠️ 管理者面板</h2>
                <button class="admin-logout-btn" onclick="adminLogout()">登出</button>
            </div>
            <div class="admin-panel-container">
                <div class="admin-sidebar">
                    <div class="admin-tab active" onclick="switchAdminTab('dashboard')">
                        <span class="admin-tab-icon">📊</span> 儀表板
                    </div>
                    <div class="admin-tab" onclick="switchAdminTab('security')">
                        <span class="admin-tab-icon">🔒</span> 安全性設定
                    </div>
                    <div class="admin-tab" onclick="switchAdminTab('products')">
                        <span class="admin-tab-icon">📦</span> 商品管理
                    </div>
                    <div class="admin-tab" onclick="switchAdminTab('orders')">
                        <span class="admin-tab-icon">📋</span> 訂單管理
                    </div>
                    <div class="admin-tab" onclick="switchAdminTab('admins')" id="admin-tab-admins">
                        <span class="admin-tab-icon">👥</span> 管理員管理
                    </div>
                    <div class="admin-tab" onclick="switchAdminTab('logs')">
                        <span class="admin-tab-icon">📜</span> 安全日誌
                    </div>
                </div>
                <div class="admin-content">
                    <div id="admin-dashboard" class="admin-tab-content" style="display: block;">
                        <!-- 儀表板內容 -->
                    </div>
                    <div id="admin-security" class="admin-tab-content">
                        <!-- 安全性設定內容 -->
                    </div>
                    <div id="admin-products" class="admin-tab-content">
                        <!-- 商品管理內容 -->
                    </div>
                    <div id="admin-orders" class="admin-tab-content">
                        <!-- 訂單管理內容 -->
                    </div>
                    <div id="admin-admins" class="admin-tab-content">
                        <!-- 管理員管理內容 -->
                        <div class="admin-section">
                            <div class="section-header">
                                <h3>👥 管理員帳號管理</h3>
                                <button onclick="showAddAdminForm()" class="add-admin-btn" id="add-admin-btn">➕ 新增管理員</button>
                            </div>
                            <div id="admins-list" class="admins-list">
                                <!-- 管理員列表會由 JavaScript 動態生成 -->
                            </div>
                        </div>
                    </div>
                    <div id="admin-logs" class="admin-tab-content">
                        <!-- 安全日誌內容 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 新增商品 -->
    <div class="modal" id="add-product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>➕ 新增商品</h2>
                <button class="close-btn" onclick="closeAddProductForm()">✕</button>
            </div>
            <form onsubmit="submitAddProduct(event)">
                <div class="form-group">
                    <label>商品 ID *</label>
                    <input type="text" id="new-product-id" placeholder="例如：E" required>
                    <small>唯一識別碼，不可重複</small>
                </div>
                <div class="form-group">
                    <label>商品名稱 *</label>
                    <input type="text" id="new-product-name" placeholder="例如：咖啡豆 E" required>
                </div>
                <div class="form-group">
                    <label>描述</label>
                    <textarea id="new-product-description" rows="3" placeholder="商品描述"></textarea>
                </div>
                <div class="form-group">
                    <label>商品圖片</label>
                    <div class="image-preview" id="new-product-preview">
                        <div style="font-size: 48px;">☕</div>
                    </div>
                    <div class="image-upload-options">
                        <label class="upload-tab active" onclick="switchNewProductUploadMode('file')">
                            <input type="radio" name="new-upload-mode" value="file" checked> 上傳圖片
                        </label>
                        <label class="upload-tab" onclick="switchNewProductUploadMode('url')">
                            <input type="radio" name="new-upload-mode" value="url"> 圖片網址
                        </label>
                    </div>
                    <div id="new-upload-file" class="upload-section active">
                        <input type="file" id="new-image-file" accept="image/*" onchange="previewNewProductImage(event)">
                        <small>支援 JPG、PNG、GIF、WebP，最大 5MB</small>
                    </div>
                    <div id="new-upload-url" class="upload-section" style="display:none;">
                        <input type="url" id="new-image-url" placeholder="https://example.com/image.jpg" onchange="previewNewProductImageURL(event)">
                        <small>請輸入圖片網址</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>120g 價格（NT$）*</label>
                        <input type="number" id="new-product-price120" placeholder="350" required min="0">
                    </div>
                    <div class="form-group">
                        <label>260g 價格（NT$）*</label>
                        <input type="number" id="new-product-price260" placeholder="680" required min="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>產地</label>
                    <input type="text" id="new-product-origin" placeholder="例如：哥倫比亞">
                </div>
                <div class="form-group">
                    <label>烘焙度</label>
                    <input type="text" id="new-product-roast" placeholder="例如：中烘焙">
                </div>
                <div class="form-group">
                    <label>風味</label>
                    <input type="text" id="new-product-flavor" placeholder="例如：堅果,巧克力,焦糖">
                    <small>用逗號分隔</small>
                </div>
                <button type="submit" class="submit-btn">➕ 新增商品</button>
            </form>
        </div>
    </div>

    <!-- 新增/編輯管理員 -->
    <div class="modal" id="admin-form-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="admin-form-title">➕ 新增管理員</h2>
                <button class="close-btn" onclick="closeAdminForm()">✕</button>
            </div>
            <form onsubmit="submitAdminForm(event)">
                <input type="hidden" id="edit-admin-username">

                <div class="form-group">
                    <label>帳號 *</label>
                    <input type="text" id="admin-form-username" placeholder="請輸入帳號" required>
                    <small>登入時使用的帳號名稱</small>
                </div>

                <div class="form-group">
                    <label>顯示名稱 *</label>
                    <input type="text" id="admin-form-displayname" placeholder="請輸入顯示名稱" required>
                    <small>在系統中顯示的名稱</small>
                </div>

                <div class="form-group">
                    <label id="admin-form-password-label">密碼 *</label>
                    <input type="password" id="admin-form-password" placeholder="請輸入密碼">
                    <small id="admin-form-password-hint">至少 6 個字元</small>
                </div>

                <div class="form-group">
                    <label>權限設定</label>
                    <div class="permissions-grid">
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageProducts">
                            <span>管理商品（新增、編輯、刪除）</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageImages">
                            <span>管理圖片</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageOrders">
                            <span>管理訂單</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageMembers">
                            <span>管理會員</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageSecurity">
                            <span>管理安全設定</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageAdmins">
                            <span>管理管理員帳號</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-viewStats">
                            <span>查看統計資料</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-viewLogs">
                            <span>查看日誌</span>
                        </label>
                    </div>
                    <div style="margin-top: 10px;">
                        <button type="button" onclick="selectAllPermissions()" class="small-btn">全選</button>
                        <button type="button" onclick="clearAllPermissions()" class="small-btn">清除</button>
                    </div>
                </div>

                <button type="submit" class="submit-btn" id="admin-form-submit">➕ 新增管理員</button>
            </form>
        </div>
    </div>

    <!-- JavaScript 檔案 -->
    <script src="products.js"></script>
    <script src="security.js"></script>
    <script src="cart.js"></script>
    <script src="checkout.js"></script>
    <script src="member.js"></script>
    <script src="order-tracking.js"></script>
    <script src="coupon.js"></script>
    <script src="inventory.js"></script>
    <script src="payment.js"></script>
    <script src="reviews.js"></script>
    <script src="recommendations.js"></script>
    <script src="permission-system.js"></script>
    <script src="admin-system.js"></script>
    <script src="admin-management.js"></script>
    <script src="admin-panel.js"></script>
    <script src="site-config.js"></script>
</body>
</html>
