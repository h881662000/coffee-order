# 🛠️ 管理者功能使用指南

## 目錄

1. [登入管理者帳號](#登入管理者帳號)
2. [儀表板](#儀表板)
3. [安全性設定](#安全性設定)
4. [商品管理](#商品管理)
5. [訂單管理](#訂單管理)
6. [安全日誌](#安全日誌)
7. [常見問題](#常見問題)

---

## 登入管理者帳號

### 步驟 1: 開啟網站

前往您的咖啡訂購網站：
```
https://h881662000.github.io/coffee-order/
```

### 步驟 2: 點選管理者按鈕

在右上角導覽列找到「🔐 管理者」按鈕，點選後會開啟登入對話框。

### 步驟 3: 輸入帳號密碼

**預設帳號密碼：**
- 帳號：`admin`
- 密碼：`admin123`

### 步驟 4: 登入成功

登入成功後：
- 「🔐 管理者」按鈕會變成「🛠️ 管理者面板」
- Session 會保存 24 小時
- 24 小時內重新開啟網站不需再次登入

---

## 儀表板

### 功能概覽

登入後，預設會顯示儀表板，提供以下資訊：

#### 📊 訂單統計
- **總訂單數** - 所有訂單的總數量
- **今日訂單** - 今天的訂單數量
- **本週訂單** - 最近 7 天的訂單數量
- **本月訂單** - 本月的訂單數量

#### 💰 營收統計
- **總營收** - 所有訂單的總金額
- **平均訂單金額** - 每筆訂單的平均金額

#### 🔥 熱門商品
- 顯示銷量前 3 名的商品
- 包含銷量和營收資訊

#### ⚙️ 系統狀態
- 管理者帳號
- 登入時間
- 安全系統狀態

---

## 安全性設定

### 🚦 訂單頻率限制

**用途：** 防止惡意大量訂單攻擊

**設定項目：**

1. **時間窗口內最大訂單數**
   - 預設：3 筆
   - 範圍：1-100
   - 說明：每個裝置在指定時間內最多可下幾筆訂單

2. **時間窗口（分鐘）**
   - 預設：60 分鐘
   - 範圍：1-1440（1 天）
   - 說明：統計訂單數的時間範圍

3. **封鎖時間（分鐘）**
   - 預設：1440 分鐘（24 小時）
   - 範圍：1-10080（1 週）
   - 說明：超過限制後封鎖多久

**範例設定：**
```
時間窗口內最大訂單數：5
時間窗口：30 分鐘
封鎖時間：720 分鐘（12 小時）

→ 表示每個裝置 30 分鐘內最多可下 5 筆訂單，
   超過則封鎖 12 小時
```

---

### 🛒 購物車限制

**用途：** 防止惡意大量購買

**設定項目：**

1. **最大商品種類數**
   - 預設：20 種
   - 範圍：1-100
   - 說明：購物車最多可以有幾種不同商品

2. **單一商品最大數量**
   - 預設：10 個
   - 範圍：1-100
   - 說明：單一商品最多可以買幾個

3. **購物車總數量上限**
   - 預設：50 個
   - 範圍：1-1000
   - 說明：購物車所有商品數量總和上限

---

### 💵 訂單金額限制

**用途：** 防止異常訂單

**設定項目：**

1. **最低訂單金額（NT$）**
   - 預設：100 元
   - 範圍：0-100000
   - 說明：訂單金額不得低於此數值

2. **最高訂單金額（NT$）**
   - 預設：50000 元
   - 範圍：100-1000000
   - 說明：訂單金額不得高於此數值

---

### 🔢 驗證碼設定

**用途：** 防止機器人自動下單

**設定項目：**

1. **啟用驗證碼**
   - 預設：啟用
   - 說明：關閉後將不會顯示驗證碼

2. **數字範圍（最小值）**
   - 預設：1
   - 範圍：1-50

3. **數字範圍（最大值）**
   - 預設：20
   - 範圍：10-100

**範例：**
```
最小值：1，最大值：20
→ 驗證碼會出現類似「7 + 13 = ?」的題目
```

---

### ✅ 驗證選項

**設定項目：**

1. **嚴格驗證模式**
   - 預設：啟用
   - 說明：啟用更嚴格的資料驗證（例如電話格式、Email 格式）

2. **後端價格驗證**
   - 預設：啟用
   - 說明：在後端再次驗證商品價格（防止前端被竄改）

---

### 💾 儲存設定

完成設定後，點選「💾 儲存設定」按鈕。

**注意事項：**
- 設定會立即生效
- 設定儲存在瀏覽器 localStorage
- 如需重設，點選「🔄 重設為預設值」

---

## 商品管理

### 檢視商品列表

在「📦 商品管理」分頁中，可以看到所有商品的卡片。

每張卡片顯示：
- 商品 ID
- 商品名稱
- 描述
- 120g 和 260g 價格
- 產地
- 烘焙度
- 風味

---

### 編輯商品

在商品卡片中，可以直接修改：

1. **商品名稱** - 顯示在前台的名稱
2. **描述** - 商品說明文字
3. **120g 價格** - 小包裝價格
4. **260g 價格** - 大包裝價格
5. **產地** - 咖啡豆產地
6. **烘焙度** - 例如：淺烘焙、中烘焙、深烘焙
7. **風味** - 用逗號分隔，例如：堅果,巧克力,焦糖

**儲存變更：**

修改完成後，點選商品卡片下方的「💾 儲存變更」按鈕。

---

### 新增商品

#### 步驟 1: 點選「➕ 新增商品」按鈕

位於商品管理頁面右上角。

#### 步驟 2: 填寫商品資訊

**必填欄位：**
- 商品 ID（唯一識別碼，不可重複）
- 商品名稱
- 120g 價格
- 260g 價格

**選填欄位：**
- 描述
- 產地
- 烘焙度
- 風味

#### 步驟 3: 送出

點選「➕ 新增商品」按鈕。

**範例：**
```
商品 ID: E
商品名稱: 咖啡豆 E
描述: 來自衣索比亞的精品咖啡豆
120g 價格: 380
260g 價格: 750
產地: 衣索比亞
烘焙度: 淺烘焙
風味: 花香,柑橘,莓果
```

---

### 刪除商品

在商品卡片右上角，點選「🗑️ 刪除」按鈕。

**警告：**
- 此操作無法復原！
- 刪除後，該商品將從前台消失
- 已存在的訂單不受影響

---

## 訂單管理

### 檢視所有訂單

在「📋 訂單管理」分頁中，可以看到所有訂單列表。

訂單按時間排序（最新的在前）。

---

### 訂單資訊

每筆訂單顯示：

- **訂單編號** - 唯一訂單號碼
- **日期時間** - 下單時間
- **客戶資訊**
  - 姓名
  - 電話
  - Email
  - 地址
- **訂購商品** - 商品名稱、規格、數量
- **總金額** - 訂單總計
- **備註** - 客戶留言（如果有）

---

### 匯出訂單

點選「📥 匯出 CSV」按鈕，可以將所有訂單匯出為 CSV 檔案。

**CSV 檔案包含：**
- 訂單編號
- 日期時間
- 客戶姓名
- 電話
- Email
- 地址
- 商品明細
- 總金額
- 備註

**用途：**
- 用 Excel 開啟進行分析
- 匯入其他系統
- 列印訂單清單

---

## 安全日誌

### 檢視安全日誌

在「📜 安全日誌」分頁中，可以看到所有安全相關事件。

---

### 日誌類型

**警告類型（紅色標記）：**
- `RATE_LIMIT_EXCEEDED` - 訂單頻率超限
- `CAPTCHA_FAILED` - 驗證碼錯誤
- `VALIDATION_FAILED` - 資料驗證失敗
- `SUSPICIOUS_ORDER` - 可疑訂單

**資訊類型（藍色標記）：**
- `ORDER_SUBMITTED` - 訂單已送出
- `DEVICE_FINGERPRINT` - 裝置指紋記錄

---

### 日誌內容

每筆日誌包含：
- **類型** - 事件類型
- **時間** - 發生時間
- **詳細資料** - JSON 格式的詳細資訊

---

### 清除日誌

點選「🗑️ 清除日誌」按鈕，可以清除所有安全日誌。

**警告：** 此操作無法復原！

---

## 常見問題

### Q1: 忘記管理者密碼怎麼辦？

**A:** 密碼儲存在 `admin-system.js` 檔案中（第 8 行）。

預設密碼是 `admin123` 的 SHA-256 雜湊值。

**如需修改密碼：**

1. 開啟瀏覽器 Console（F12）
2. 執行以下指令：
```javascript
AdminSystem.hashPassword('您的新密碼').then(hash => console.log(hash))
```
3. 複製產生的雜湊值
4. 編輯 `admin-system.js` 第 8 行，貼上新的雜湊值
5. 重新上傳到 GitHub

---

### Q2: 設定會同步到所有裝置嗎？

**A:** 不會。設定儲存在瀏覽器的 localStorage，只在當前裝置生效。

如需在多個裝置使用相同設定，需要手動在每個裝置上設定。

---

### Q3: 管理者 Session 多久會過期？

**A:** 24 小時。

24 小時內重新開啟網站不需再次登入，超過 24 小時需要重新登入。

---

### Q4: 可以新增多個管理者帳號嗎？

**A:** 目前版本只支援單一管理者帳號。

如需多帳號支援，需要修改 `admin-system.js` 的程式碼。

---

### Q5: 商品變更會立即顯示在前台嗎？

**A:** 會的！

- 編輯商品後，按「💾 儲存變更」
- 前台會立即重新渲染商品列表
- 刷新頁面後仍會保留變更

---

### Q6: 如何復原誤刪的商品？

**A:** 商品刪除後無法復原。

**建議：**
- 刪除前先確認
- 定期備份 localStorage（使用瀏覽器開發者工具）

**手動復原方法：**
1. 按 F12 開啟 Console
2. 執行：
```javascript
localStorage.getItem('products_config')
```
3. 查看商品資料
4. 使用「➕ 新增商品」重新建立

---

### Q7: 安全性設定的建議值是什麼？

**A:** 根據您的業務需求調整，以下是建議值：

**一般商店（預設值）：**
```
訂單頻率：3 筆 / 60 分鐘
購物車：20 種商品，單品 10 個
訂單金額：100-50000 元
驗證碼：啟用
```

**高流量促銷期間：**
```
訂單頻率：5 筆 / 30 分鐘
購物車：30 種商品，單品 15 個
訂單金額：100-100000 元
驗證碼：啟用
```

**嚴格防護模式：**
```
訂單頻率：2 筆 / 120 分鐘
購物車：10 種商品，單品 5 個
訂單金額：200-30000 元
驗證碼：啟用，範圍 10-50
```

---

### Q8: 如何查看是否有可疑訂單？

**A:** 前往「📜 安全日誌」分頁，尋找 `SUSPICIOUS_ORDER` 類型的紀錄。

可疑訂單的判定條件：
- 同一裝置短時間內多筆訂單
- 訂單金額異常高
- 購買數量異常多
- 資料格式異常

---

### Q9: 可以設定不同商品的不同規格嗎？

**A:** 目前版本所有商品都是 120g 和 260g 兩種規格。

如需其他規格（例如 500g），需要修改 `products.js` 和相關程式碼。

---

### Q10: 儀表板的統計資料從哪裡來？

**A:** 統計資料來自 localStorage 的 `orders` 項目。

只包含本地儲存的訂單（使用這台裝置下的訂單）。

如需完整統計，請從 Google Sheets 匯出資料分析。

---

## 🔐 安全建議

### 1. 修改預設密碼

**強烈建議** 修改預設密碼！

步驟見 [Q1: 忘記管理者密碼怎麼辦？](#q1-忘記管理者密碼怎麼辦)

---

### 2. 定期檢查安全日誌

建議每週檢查一次安全日誌，注意：
- 頻繁的驗證碼失敗
- 大量的頻率限制超限
- 可疑訂單標記

---

### 3. 適當設定安全參數

根據您的業務需求調整安全參數，在便利性和安全性之間取得平衡。

---

### 4. 備份重要資料

定期備份：
- Google Sheets 訂單資料
- localStorage 商品設定
- 安全日誌

---

## 📞 需要協助？

如有任何問題：

1. 查看本文件的常見問題
2. 參考 `TROUBLESHOOTING.md` 故障排除指南
3. 檢查瀏覽器 Console 錯誤訊息
4. 查看 `README-FULL.md` 完整功能說明

---

**祝您管理順利！** 🎉
