<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“åˆ—è¡¨ - DiDoå’–å•¡</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles-extended.css">
    <link rel="stylesheet" href="admin-styles.css">
    <link rel="stylesheet" href="elegant-effects.css">
    <link rel="stylesheet" href="mobile-optimization.css">
    <style>
        /* å•†å“é é¢å°ˆç”¨æ¨£å¼ */
        .products-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* ç¯©é¸å´é‚Šæ¬„ */
        .filter-sidebar {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .filter-sidebar h2 {
            font-size: 1.3rem;
            color: #3d2817;
            margin-bottom: 20px;
        }

        .filter-section {
            margin-bottom: 24px;
        }

        .filter-section h3 {
            font-size: 0.95rem;
            color: #6F4E37;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .filter-search,
        .filter-select,
        .filter-input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e8dfd5;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .filter-search:focus,
        .filter-select:focus,
        .filter-input:focus {
            border-color: #6F4E37;
            outline: none;
            box-shadow: 0 0 0 4px rgba(111, 78, 55, 0.1);
        }

        .price-range-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .price-range-inputs input {
            flex: 1;
        }

        .price-range-inputs span {
            color: #999;
        }

        .filter-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 24px;
        }

        .apply-filter-btn,
        .reset-filter-btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .apply-filter-btn {
            background: #6F4E37;
            color: white;
        }

        .apply-filter-btn:hover {
            background: #5a3d2a;
        }

        .reset-filter-btn {
            background: #f0f0f0;
            color: #666;
        }

        .reset-filter-btn:hover {
            background: #e0e0e0;
        }

        /* å•†å“å±•ç¤ºå€åŸŸ */
        .products-main {
            min-height: 60vh;
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .products-header h2 {
            font-size: 2rem;
            color: #3d2817;
        }

        #product-count {
            color: #666;
            font-size: 0.95rem;
        }

        .no-products {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
        }

        .no-products p {
            font-size: 1.2rem;
            color: #999;
            margin-bottom: 20px;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 968px) {
            .products-container {
                grid-template-columns: 1fr;
            }

            .filter-sidebar {
                position: static;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <!-- å°èˆªæœƒç”± common.js ç”Ÿæˆ -->
        </div>
    </header>

    <main class="container">
        <div class="products-container">
            <!-- ç¯©é¸å´é‚Šæ¬„ -->
            <aside class="filter-sidebar">
                <h2>ğŸ” ç¯©é¸å•†å“</h2>
                <div id="product-filters">
                    <!-- ç¯©é¸å™¨æœƒç”± product-filter.js ç”Ÿæˆ -->
                </div>
            </aside>

            <!-- å•†å“å±•ç¤ºå€åŸŸ -->
            <div class="products-main">
                <div class="products-header">
                    <h2>ç²¾é¸å’–å•¡è±†</h2>
                    <span id="product-count">è¼‰å…¥ä¸­...</span>
                </div>

                <div class="product-grid" id="product-grid">
                    <!-- å•†å“å¡ç‰‡æœƒç”± product-filter.js ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </main>

    <!-- è³¼ç‰©è»Šå´é‚Šæ¬„ -->
    <div class="cart-sidebar" id="cart-sidebar">
        <div class="cart-header">
            <h2>è³¼ç‰©è»Š</h2>
            <button class="close-btn" onclick="toggleCart()">âœ•</button>
        </div>
        <div class="cart-items" id="cart-items"></div>

        <div id="cart-recommendations" style="display:none;"></div>

        <div class="cart-coupon">
            <input type="text" id="coupon-code" placeholder="è¼¸å…¥å„ªæƒ åˆ¸ä»£ç¢¼">
            <button onclick="applyCoupon()" class="apply-coupon-btn">å¥—ç”¨</button>
            <button onclick="showAvailableCoupons()" class="view-coupons-btn">æŸ¥çœ‹å„ªæƒ åˆ¸</button>
        </div>

        <div class="cart-footer">
            <div id="order-price-summary" class="price-summary">
                <div class="price-row">
                    <span>ç¸½è¨ˆï¼š</span>
                    <span id="cart-total">NT$ 0</span>
                </div>
            </div>
            <button class="checkout-btn" onclick="showCheckoutForm()">çµå¸³</button>
        </div>
    </div>

    <!-- çµå¸³è¡¨å–®é®ç½© -->
    <div class="modal" id="checkout-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>å¡«å¯«è¨‚è³¼è³‡è¨Š</h2>
                <button class="close-btn" onclick="closeCheckoutForm()">âœ•</button>
            </div>
            <form id="checkout-form" onsubmit="submitOrder(event)">
                <div class="form-group">
                    <label for="customer-name">å§“å *</label>
                    <input type="text" id="customer-name" required>
                </div>
                <div class="form-group">
                    <label for="customer-phone">é›»è©± *</label>
                    <input type="tel" id="customer-phone" required>
                </div>
                <div class="form-group">
                    <label for="customer-email">Email</label>
                    <input type="email" id="customer-email">
                </div>
                <div class="form-group">
                    <label for="customer-address">åœ°å€ *</label>
                    <textarea id="customer-address" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="customer-note">å‚™è¨»</label>
                    <textarea id="customer-note" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label>ä»˜æ¬¾æ–¹å¼ *</label>
                    <div id="payment-methods"></div>
                </div>

                <div class="form-group captcha-group">
                    <label>å®‰å…¨é©—è­‰ *</label>
                    <div class="captcha-container">
                        <div class="captcha-question" id="captcha-question">è¼‰å…¥ä¸­...</div>
                        <input type="number" id="captcha-answer" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ" required>
                        <button type="button" onclick="refreshCaptcha()" class="captcha-refresh">ğŸ”„ é‡æ–°æ•´ç†</button>
                    </div>
                    <p class="captcha-hint">è«‹è¨ˆç®—ä¸Šæ–¹ç®—å¼ä»¥é©—è­‰æ‚¨ä¸æ˜¯æ©Ÿå™¨äºº</p>
                </div>

                <div class="order-summary">
                    <h3>è¨‚å–®æ˜ç´°</h3>
                    <div id="order-summary-items"></div>
                    <div class="order-total">
                        <strong>ç¸½é‡‘é¡ï¼š<span id="order-total">NT$ 0</span></strong>
                    </div>
                </div>
                <button type="submit" class="submit-btn">é€å‡ºè¨‚å–®</button>
            </form>
        </div>
    </div>

    <!-- è¨‚å–®å®Œæˆè¨Šæ¯ -->
    <div class="modal" id="success-modal">
        <div class="modal-content success-content">
            <div class="success-icon">âœ“</div>
            <h2>è¨‚å–®å·²é€å‡ºï¼</h2>
            <p>æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„è¨‚å–®ï¼Œå°‡ç›¡å¿«èˆ‡æ‚¨è¯ç¹«ç¢ºèªã€‚</p>
            <p class="order-number">è¨‚å–®ç·¨è™Ÿï¼š<span id="order-number"></span></p>
            <button class="submit-btn" onclick="closeSuccessModal()">è¿”å›é¦–é </button>
        </div>
    </div>

    <!-- æœƒå“¡ç™»å…¥ -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç™»å…¥</h2>
                <button class="close-btn" onclick="closeLoginModal()">âœ•</button>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="login-account">å¸³è™Ÿ / Email / é›»è©± *</label>
                    <input type="text" id="login-account" placeholder="è«‹è¼¸å…¥å¸³è™Ÿã€Email æˆ–é›»è©±" required>
                </div>
                <div class="form-group">
                    <label for="login-password">å¯†ç¢¼</label>
                    <input type="password" id="login-password" placeholder="æœƒå“¡ç™»å…¥å¯ç•™ç©ºï¼Œç®¡ç†è€…è«‹è¼¸å…¥å¯†ç¢¼">
                </div>
                <button type="submit" class="submit-btn">ç™»å…¥</button>
                <p class="form-footer">é‚„ä¸æ˜¯æœƒå“¡ï¼Ÿ<a href="#" onclick="closeLoginModal();showRegisterModal()">ç«‹å³è¨»å†Š</a></p>
            </form>
        </div>
    </div>

    <!-- æœƒå“¡è¨»å†Š -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æœƒå“¡è¨»å†Š</h2>
                <button class="close-btn" onclick="closeRegisterModal()">âœ•</button>
            </div>
            <form id="register-form" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label for="register-name">å§“å *</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email *</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label for="register-phone">é›»è©± *</label>
                    <input type="tel" id="register-phone" required>
                </div>
                <div class="form-group">
                    <label for="register-address">åœ°å€</label>
                    <textarea id="register-address" rows="3"></textarea>
                </div>
                <button type="submit" class="submit-btn">è¨»å†Š</button>
            </form>
        </div>
    </div>

    <!-- å„ªæƒ åˆ¸åˆ—è¡¨ -->
    <div class="modal" id="coupons-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>å¯ç”¨å„ªæƒ åˆ¸</h2>
                <button class="close-btn" onclick="closeCouponsModal()">âœ•</button>
            </div>
            <div id="coupons-list"></div>
        </div>
    </div>

    <!-- ç®¡ç†è€…é¢æ¿ -->
    <div class="modal" id="admin-panel-modal">
        <div class="modal-content">
            <div class="admin-header-bar">
                <h2>ğŸ› ï¸ ç®¡ç†è€…é¢æ¿</h2>
                <button class="admin-logout-btn" onclick="adminLogout()">ç™»å‡º</button>
            </div>
            <div class="admin-panel-container">
                <div class="admin-sidebar">
                    <div class="admin-tab active" onclick="switchAdminTab('dashboard')">
                        <span class="admin-tab-icon">ğŸ“Š</span> å„€è¡¨æ¿
                    </div>
                    <div class="admin-tab" onclick="switchAdminTab('security')">
                        <span class="admin-tab-icon">ğŸ”’</span> å®‰å…¨æ€§è¨­å®š
                    </div>
                    <div class="admin-tab" onclick="switchAdminTab('products')">
                        <span class="admin-tab-icon">ğŸ“¦</span> å•†å“ç®¡ç†
                    </div>
                    <div class="admin-tab" onclick="switchAdminTab('orders')">
                        <span class="admin-tab-icon">ğŸ“‹</span> è¨‚å–®ç®¡ç†
                    </div>
                    <div class="admin-tab" onclick="switchAdminTab('admins')" id="admin-tab-admins">
                        <span class="admin-tab-icon">ğŸ‘¥</span> ç®¡ç†å“¡ç®¡ç†
                    </div>
                    <div class="admin-tab" onclick="switchAdminTab('logs')">
                        <span class="admin-tab-icon">ğŸ“œ</span> å®‰å…¨æ—¥èªŒ
                    </div>
                </div>
                <div class="admin-content">
                    <div id="admin-dashboard" class="admin-tab-content" style="display: block;"></div>
                    <div id="admin-security" class="admin-tab-content"></div>
                    <div id="admin-products" class="admin-tab-content"></div>
                    <div id="admin-orders" class="admin-tab-content"></div>
                    <div id="admin-admins" class="admin-tab-content">
                        <div class="admin-section">
                            <div class="section-header">
                                <h3>ğŸ‘¥ ç®¡ç†å“¡å¸³è™Ÿç®¡ç†</h3>
                                <button onclick="showAddAdminForm()" class="add-admin-btn" id="add-admin-btn">â• æ–°å¢ç®¡ç†å“¡</button>
                            </div>
                            <div id="admins-list" class="admins-list"></div>
                        </div>
                    </div>
                    <div id="admin-logs" class="admin-tab-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å¢å•†å“ -->
    <div class="modal" id="add-product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>â• æ–°å¢å•†å“</h2>
                <button class="close-btn" onclick="closeAddProductForm()">âœ•</button>
            </div>
            <form onsubmit="submitAddProduct(event)">
                <div class="form-group">
                    <label>å•†å“ ID *</label>
                    <input type="text" id="new-product-id" placeholder="ä¾‹å¦‚ï¼šE" required>
                    <small>å”¯ä¸€è­˜åˆ¥ç¢¼ï¼Œä¸å¯é‡è¤‡</small>
                </div>
                <div class="form-group">
                    <label>å•†å“åç¨± *</label>
                    <input type="text" id="new-product-name" placeholder="ä¾‹å¦‚ï¼šå’–å•¡è±† E" required>
                </div>
                <div class="form-group">
                    <label>æè¿°</label>
                    <textarea id="new-product-description" rows="3" placeholder="å•†å“æè¿°"></textarea>
                </div>
                <div class="form-group">
                    <label>å•†å“åœ–ç‰‡</label>
                    <div class="image-preview" id="new-product-preview">
                        <div style="font-size: 48px;">â˜•</div>
                    </div>
                    <div class="image-upload-options">
                        <label class="upload-tab active" onclick="switchNewProductUploadMode('file')">
                            <input type="radio" name="new-upload-mode" value="file" checked> ä¸Šå‚³åœ–ç‰‡
                        </label>
                        <label class="upload-tab" onclick="switchNewProductUploadMode('url')">
                            <input type="radio" name="new-upload-mode" value="url"> åœ–ç‰‡ç¶²å€
                        </label>
                    </div>
                    <div id="new-upload-file" class="upload-section active">
                        <input type="file" id="new-image-file" accept="image/*" onchange="previewNewProductImage(event)">
                        <small>æ”¯æ´ JPGã€PNGã€GIFã€WebPï¼Œæœ€å¤§ 5MB</small>
                    </div>
                    <div id="new-upload-url" class="upload-section" style="display:none;">
                        <input type="url" id="new-image-url" placeholder="https://example.com/image.jpg" onchange="previewNewProductImageURL(event)">
                        <small>è«‹è¼¸å…¥åœ–ç‰‡ç¶²å€</small>
                    </div>
                </div>
                <div class="form-group">
                    <label>å•†å“è¦æ ¼èˆ‡åƒ¹æ ¼ *</label>
                    <div id="new-product-prices-container">
                        <div class="price-row">
                            <input type="text" placeholder="è¦æ ¼åç¨±ï¼ˆå¦‚ï¼š120gï¼‰" class="spec-name" required>
                            <input type="number" placeholder="åƒ¹æ ¼" class="spec-price" required min="0">
                            <button type="button" class="remove-spec-btn" onclick="removeNewProductSpec(this)" style="display:none;">âœ•</button>
                        </div>
                    </div>
                    <button type="button" class="add-spec-btn" onclick="addNewProductSpec()">+ æ–°å¢è¦æ ¼</button>
                    <small>è‡³å°‘éœ€è¦ 1 ç¨®è¦æ ¼</small>
                </div>
                <div class="form-group">
                    <label>ç”¢åœ°</label>
                    <input type="text" id="new-product-origin" placeholder="ä¾‹å¦‚ï¼šå“¥å€«æ¯”äº">
                </div>
                <div class="form-group">
                    <label>çƒ˜ç„™åº¦</label>
                    <input type="text" id="new-product-roast" placeholder="ä¾‹å¦‚ï¼šä¸­çƒ˜ç„™">
                </div>
                <div class="form-group">
                    <label>é¢¨å‘³</label>
                    <input type="text" id="new-product-flavor" placeholder="ä¾‹å¦‚ï¼šå …æœ,å·§å…‹åŠ›,ç„¦ç³–">
                    <small>ç”¨é€—è™Ÿåˆ†éš”</small>
                </div>
                <button type="submit" class="submit-btn">â• æ–°å¢å•†å“</button>
            </form>
        </div>
    </div>

    <!-- æ–°å¢/ç·¨è¼¯ç®¡ç†å“¡ -->
    <div class="modal" id="admin-form-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="admin-form-title">â• æ–°å¢ç®¡ç†å“¡</h2>
                <button class="close-btn" onclick="closeAdminForm()">âœ•</button>
            </div>
            <form onsubmit="submitAdminForm(event)">
                <input type="hidden" id="edit-admin-username">
                <div class="form-group">
                    <label>å¸³è™Ÿ *</label>
                    <input type="text" id="admin-form-username" placeholder="è«‹è¼¸å…¥å¸³è™Ÿ" required>
                    <small>ç™»å…¥æ™‚ä½¿ç”¨çš„å¸³è™Ÿåç¨±</small>
                </div>
                <div class="form-group">
                    <label>é¡¯ç¤ºåç¨± *</label>
                    <input type="text" id="admin-form-displayname" placeholder="è«‹è¼¸å…¥é¡¯ç¤ºåç¨±" required>
                    <small>åœ¨ç³»çµ±ä¸­é¡¯ç¤ºçš„åç¨±</small>
                </div>
                <div class="form-group">
                    <label id="admin-form-password-label">å¯†ç¢¼ *</label>
                    <input type="password" id="admin-form-password" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
                    <small id="admin-form-password-hint">è‡³å°‘ 6 å€‹å­—å…ƒ</small>
                </div>
                <div class="form-group">
                    <label>æ¬Šé™è¨­å®š</label>
                    <div class="permissions-grid">
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageProducts">
                            <span>ç®¡ç†å•†å“ï¼ˆæ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤ï¼‰</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageImages">
                            <span>ç®¡ç†åœ–ç‰‡</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageOrders">
                            <span>ç®¡ç†è¨‚å–®</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageMembers">
                            <span>ç®¡ç†æœƒå“¡</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageSecurity">
                            <span>ç®¡ç†å®‰å…¨è¨­å®š</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-manageAdmins">
                            <span>ç®¡ç†ç®¡ç†å“¡å¸³è™Ÿ</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-viewStats">
                            <span>æŸ¥çœ‹çµ±è¨ˆè³‡æ–™</span>
                        </label>
                        <label class="permission-item">
                            <input type="checkbox" id="perm-viewLogs">
                            <span>æŸ¥çœ‹æ—¥èªŒ</span>
                        </label>
                    </div>
                    <div style="margin-top: 10px;">
                        <button type="button" onclick="selectAllPermissions()" class="small-btn">å…¨é¸</button>
                        <button type="button" onclick="clearAllPermissions()" class="small-btn">æ¸…é™¤</button>
                    </div>
                </div>
                <button type="submit" class="submit-btn" id="admin-form-submit">â• æ–°å¢ç®¡ç†å“¡</button>
            </form>
        </div>
    </div>

    <!-- JavaScript æª”æ¡ˆ -->
    <script src="products.js"></script>
    <script src="security.js"></script>
    <script src="cart.js"></script>
    <script src="checkout.js"></script>
    <script src="member.js"></script>
    <script src="order-tracking.js"></script>
    <script src="coupon.js"></script>
    <script src="payment.js"></script>
    <script src="permission-system.js"></script>
    <script src="admin-system.js"></script>
    <script src="admin-management.js"></script>
    <script src="admin-panel.js"></script>
    <script src="site-config.js"></script>
    <script src="product-filter.js"></script>
    <script src="common.js"></script>
</body>
</html>
